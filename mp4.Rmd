---
title: "MP4"
author: "Audrey Bertin & Eva Gerstle"
date: "11/27/2017"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = FALSE, warning = FALSE}

library(mdsr)
library(tidyverse)
library(RMySQL)
library(ggthemes)
library(rvest)
library(knitr)
db <-dbConnect_scidb(dbname = "imdb")

```


![](https://i.pinimg.com/736x/bb/4e/16/bb4e169b259dca3a91b0174249f6f3c1--movie-memes-tv-movie.jpg)


You’ve heard it said: no movies are original anymore. It certainly feels that way. [Just this year](http://uproxx.com/movies/2017-sequels/) we have Cars 3, The Mummy, a new Guardians of the Galaxy movie, a remake of Beauty and the Beast, a new Fast and the Furious, the ninth Planet of the Apes movie, and the latest installment in the Star Wars franchise. However, in reality, far fewer of these movies are released than may appear. 

In a [Tylt poll](https://thetylt.com/entertainment/are-there-too-many-hollywood-reboots-and-sequels), the vast majority (79.3%) of respondents said that they believe there are “#TooManyReboots.” We set out to determine if this was actually true, or if the number of unoriginal movies is being blown out of proportion. As it turns out, we are not even at peak sequel or remake production in history, and when considering the fact that more movies are being made now than ever before, unoriginal films make up significantly smaller proportion of the movie industry than they have in the past.

In order to determine the number of unoriginal movies produced since 1895, we pulled data on all movies in the IMDb tagged with the keywords “`remake`,” “`reboot`,” or “`sequel`.” These tags represent unoriginal movies:

Remakes generally reference projects that keep the most important features of an older movie, such as characters and story, and and remake it using different actors, more advanced film techniques or special effects. Often, remakes tend to add new, socially relevant dialogue in order to appeal to modern audiences. Think Scarface, which was based on a 1932 movie of the same name.

Reboots are complete overhauls of the source material–a reimagining of a story. Typically, the source is stripped down to only its most core elements, and a new story is built predominantly from scratch. Think "Batman Begins" or the 2009 Star Trek movie that my family lovingly refers to as "Star Trek Kids".

Sequels are works that continue the story of, or expand upon, earlier films. These generally have the same characters, and often similar settings, as the films they fellow. Pretty much every major film franchise has lots of sequels-Star Wars, Marvel superhero movies, and Pirates of the Caribbean, to name a few.



```{r}

# Query to find all movies tagged with remake, reboot, or sequel

remakes_reboots_sequels <- db %>%
  dbGetQuery(
    "SELECT kw.id, kw.keyword, t.title, t.production_year 
     FROM imdb.keyword kw
     JOIN movie_keyword mkw 
     ON kw.id = mkw.keyword_id
     JOIN title t
     ON t.id = mkw.movie_id
     WHERE kw.id IN (82, 1134, 20757) AND t.kind_id = 1;")

# 82, 1134, and 20757 are the keyword id numbers that correspond to the keywords remake, reboot, and sequel.
    
#This query is optimized because we use the primary keys in the keyword and title tables to join. When we use "where" to select the IDs from title and keyword, SQL only has to look at 1 and 3 rows, respectively. On movie keyword, keyword id is indexed, so we only have to look at 32 rows when referencing that table! Therefore, this query is extremely fast.


remakes_by_year <- remakes_reboots_sequels %>%
  filter(!is.na(production_year)) %>%
  group_by(production_year) %>%
  summarize(
    reboot = sum(keyword == "reboot"),
    remake = sum(keyword == "remake"),
    sequel = sum(keyword == "sequel"))

remakes_by_year_gathered <- remakes_by_year %>%
  gather(key = "type", value = "count", reboot:sequel)

#This code puts the information pulled from the query into a form that allows us to graph the information for sequels, remakes, and reboots all on one single graph.

#Note that the movie_keyword table includes keywords for remake, sequel, AND reboot (unlike the link_type table), so here we can see reboots as well.

```


```{r}

# Function to find the 3 years with the most sequels, remakes, and reboots

most_in_year <- function(movie_type) {
  
  remakes_reboots_sequels %>%
  filter(keyword == movie_type, !is.na(production_year)) %>%
  group_by(production_year, keyword) %>%
  summarize(N = n()) %>%
  arrange(desc(N)) %>%
  head(1)
  
}

# The above function finds the year with the most movies of a given type made (e.g. the year with the most sequels)

list <- c("reboot", "remake", "sequel")
top_year_by_type <- lapply(list, FUN = most_in_year) %>% bind_rows()

```


```{r, warning = FALSE}

# Graph the numbers of remakes, reboots, and sequels over time

remakes_by_year_gathered$type <- factor(remakes_by_year_gathered$type, levels = c("sequel", "remake", "reboot"))

plot <- remakes_by_year_gathered %>%
  ggplot(aes(x = production_year, y = count, fill = type)) +
  geom_area(alpha = 0.6, position = "dodge") +
  scale_x_continuous(
    breaks = c(1900, 1910, 1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2020),
    expand = c(0,0)) + 
    # Add more labels (for each decade) to the plot
  scale_y_continuous(
    breaks = c(0, 30, 60, 90, 120),
    labels = c("0", "30", "60", "90", "120 Movies")
  ) + 
  geom_vline(xintercept = 2017) +
  # Add a line showing the current year. All movies after this line are planned and not actually finished.
  scale_fill_brewer(
    palette = "Set1",
    name= "Movie Type",
    breaks = c("sequel","remake", "reboot"),
    labels = c("Sequel", "Remake", "Reboot")) +
  xlab(NULL) +
  ylab("Number of Movies Produced") +
  ggtitle ("Number of Movie Sequels, Remakes, and Reboots Each Year Since 1895") +
  geom_curve(
    x = 1983, xend = 1994,
    y = 105, yend = 116,
    arrow = arrow(length = unit(0.3,"cm")),
    curvature = -0.5) +
  geom_curve(
    x = 1950, xend = 1942,
    y = 78, yend = 67,
    arrow = arrow(length = unit(0.3, "cm")),
    curvature = -0.5) +
  geom_curve(
    x = 2008, xend = 2017,
    y = 15, yend = 5,
    arrow = arrow(length = unit(0.3, "cm")),
    curvature = 0.5) +
  geom_text(
    x = 1955, y = 80,
    label = "Most Remakes:\n67 in 1941",
    size = 4) +
  geom_text(
    x = 1980, y = 100,
    label = "Most Sequels:\n116 in 1994",
    size = 4) +
  geom_text(
    x = 2010, y = 20,
    label = "Most Reboots:\n5 in 2017",
    size = 4) +
  theme_fivethirtyeight()

plot +
  geom_point(data = top_year_by_type, aes(x = production_year, y = N), shape = 21, size = 1, fill = "white", color = "black") #Plot top years for each type of movie as dots on the plot

```


```{r}

total_movies <- db %>%
  dbGetQuery(
    "SELECT production_year, count(*) AS number
     FROM imdb.title
     WHERE kind_id = 1 AND production_year BETWEEN 1895 and 2025
     GROUP BY production_year;")

```


```{r}
proportion <- total_movies %>%
  inner_join(remakes_by_year, by = 'production_year') %>%
  mutate(sum_srr = remake + reboot + sequel) %>%
  mutate(prop_srr = sum_srr/number *100)
```

```{r, warning=FALSE}
ggplot(proportion, aes(x= production_year, y = prop_srr)) + 
  geom_area() + 
  scale_x_continuous(name = "Production Year", limits = c(1895, 2017), breaks= c(1900,1910,1920,1930,1940,1950,1960,1970,1980,1990,2000,2010,2020), labels = c("1900",'1910','1920','1930','1940','1950','1960','1970','1980','1990','2000','2010','2020')) + 
  scale_y_continuous(breaks = c(1, 2, 3, 4), labels = c("1%", "2%", "3%", "4%")) +
  ggtitle ("Percentage of Movies Considered Unoriginal") +
  theme_fivethirtyeight()

```

```{r}
url <- "http://www.boxofficemojo.com/alltime/world/"
html_bom <- read_html(url)

tables <- html_bom %>%
  html_nodes("table")

top_grossing <- tables[[3]] %>%
  html_table(header = TRUE)

colnames(top_grossing)[4] <- "Gross (millions)"

kable(top_grossing[1:20, -(5:8) ], caption = "Top Grossing Movies of All Time")

# ^ Indicates the movie made its gross over multiple releases.
```

